<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Steve Dooley - Senior Consultant</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="https://sdooley.org/images/favicon/favicon.ico"
    />

    <!-- your site CSS (optional) -->
    <link rel="stylesheet" href="drs/css/style.css" />
    <link rel="stylesheet" href="drs/css/style2.css" />

    <!-- Font Awesome + SheetJS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <!-- Preload ES module for faster and more reliable loading -->
    <link rel="modulepreload" href="./cards.js?v=20240115q" />

    <style>
      /* Layout */
      #header-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: #fff;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.06);
      }
      body {
        padding-top: 120px;
        background: #f8fafc;
        color: #0f172a;
      }
      #page-title {
        margin-top: 20px;
        font-size: 0.8em;
        color: #0f172a;
        font-weight: bold;
        padding-left: 10px;
        margin-bottom: 0px;
        text-align: center;
      }

      /* Grid */
      #content {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 16px 40px;
      }
      #results {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #results ul {
        list-style: none;
        padding: 0;
        margin: 8px 0 32px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
      }
      #results li {
        margin: 0 !important;
        /* border: 1px solid #3b82f6 !important; */
        border: 0 !important;
        padding: 0 !important;
      }
      #results h2 {
        margin: 18px 6px 8px;
        color: #0f172a;
      }
      #results h2 i {
        color: #6b7280 !important;
      }



      /* Card shell */
      .content032825 {
        border: 2px solid transparent;
        border-radius: 16px;
        background: #fff;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04),
          0 8px 16px rgba(0, 0, 0, 0.06);
        transition: box-shadow 0.15s ease, transform 0.15s ease, border-color 0.3s ease;
        height: 380px; /* equal height; trimmed bottom whitespace */
        display: flex;
        flex-direction: column;
        min-height: 380px;
      }
      .content032825:hover {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06),
          0 10px 22px rgba(0, 0, 0, 0.08);
        transform: translateY(-1px);
        border-color: #3b82f6;
      }

      /* Taller dark header so icon/title never clip */
      .card-media {
        position: relative;
        height: 110px;
        border-radius: 12px;
        overflow: hidden;
        margin: 10px;
        background: #0f172a;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
      }
      .card-media:hover {
        text-decoration: none;
      }

      .media-title-fallback {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 5px; /* reduced top padding, increased bottom padding */
        text-align: center;
        color: #e5e7eb;
        font-weight: 800;
        font-size: 1.05rem;
      }

      /* category icon + title stack inside the fallback header */
      .tier1-stack {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        height: 100%;
        justify-content: center;
      }
      .tier1-stack .tier1-icon {
        display: block;
        line-height: 1;
        flex-shrink: 0;
      }
      .tier1-stack .tier1-title {
        display: block;
        line-height: 1.2;
        max-height: 2.4em; /* 2 lines max */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        word-wrap: break-word;
        text-align: center;
      }
      .tier1-stack .tier1-icon i {
        font-size: 28px;
        color: #e5e7eb;
        opacity: 0.95;
      }

      /* Body */
      .card-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 0 18px 10px;
        min-height: 0;
      }
      .event-content {
        margin-top: 8px;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

       #card-title-top h3 {
         padding: 20px 0 15px 0;
         margin: 0;
         color: #000000;
       }

             /* Sponsor/date row (above desc) */
       .meta-top {
         display: flex;
         justify-content: space-between;
         align-items: center;
         gap: 8px;
         min-height: 28px;
         width: 100%;
         overflow: hidden;
       }
       .meta-left {
         flex: 1;
         min-width: 0;
         overflow: hidden;
       }
                            .sponsor-badge {
           display: inline-flex;
           align-items: center;
           gap: 6px;
           background: #111827;
           color: #e5e7eb;
           padding: 4px 10px;
           border-radius: 999px;
           font-size: 0.85rem;
           font-weight: 600;
           max-width: 100%;
           white-space: nowrap;
           overflow: hidden;
           text-overflow: ellipsis;
         }
      .sponsor-badge i {
        color: #e5e7eb !important;
      }
      .sponsor-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
             .meta-right {
         color: #555;
         font-size: 0.9rem;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
       }
       .meta-date {
         color: #555;
         font-size: 0.9rem;
         margin-top: 4px;
         margin-bottom: 8px;
       }

      /* Description (60 chars + inline more) */
      .event-description {
        color: #374151;
        line-height: 1.45;
        overflow: hidden;
      }
      .more-inline {
        color: #4169e1;
        text-decoration: none;
      }
      .more-inline:hover {
        text-decoration: underline;
      }

      /* Footer: ID bottom-left */
      .card-foot {
        margin-top: auto;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        font-size: 0.75rem;
        color: #9ca3af;
      }
      .card-foot .eid {
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      }

      /* Detail page */
      .detail-wrapper {
        max-width: 960px;
        margin: 0 auto;
        padding: 0 16px 40px;
      }
      .detail-card {
        border: 2px solid #3b82f6;
        border-radius: 16px;
        padding: 0 0 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04),
          0 8px 16px rgba(0, 0, 0, 0.06);
        background: #fff;
        overflow: hidden;
      }
      .detail-media {
        position: relative;
        height: 100px;
        background: #0f172a;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        border-bottom: 1px solid #e5e7eb;
      }
      .detail-media.has-image {
        height: 80px;
      } /* detail: 80px if image present */
      .detail-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        display: block;
      }
      .detail-media .media-title-fallback {
        color: #e5e7eb;
        font-weight: 800;
        font-size: 1.5rem;
      } /* responsive fallback title */
      
      /* Mobile responsive title sizing */
      @media (max-width: 768px) {
        .detail-media .media-title-fallback {
          font-size: 1.2rem;
        }
      }
      
      @media (max-width: 480px) {
        .detail-media .media-title-fallback {
          font-size: 1rem;
        }
      }
      .detail-header {
        padding: 8px 24px 8px;
      } /* compact; no H2 title below */
      .detail-meta div {
        color: #666;
        margin-top: 4px;
      }
      .back-row {
        margin: 12px 0 12px;
        padding: 0 24px;
      }
      .back-row a {
        color: #4169e1;
        text-decoration: none;
      }
      .verify-link {
        color: #666;
        font-size: 0.95em;
        margin-left: 6px;
      }
      .section-divider {
        height: 1px;
        background: #eee;
        margin: 0px 24px 5px 24px;
      }

      @media (min-width: 1280px) {
        #content {
          max-width: 1200px;
        }
      }


      /* Quote styles for cards */
      .vspace-paragraph {
        margin-bottom: 20px;
      }
      
      .quote-begin {
        color: #4169E1;
        font-size: 1.2em;
        margin-right: 8px;
      }
      
      .blur {
        filter: blur(3px);
        user-select: none;
      }
    </style>

    <!-- Vertical spacing for paragraphs and list items -->
    <style>
      p, li {
        margin-bottom: 16px;
      }
      
      /* Ensure last elements don't have extra bottom margin */
      p:last-child, li:last-child {
        margin-bottom: 0;
      }
      
      /* Nested lists should have consistent spacing */
      ul, ol {
        margin-bottom: 16px;
      }
    </style>
  </head>
  <body>
    <!-- Header mount -->
    <div id="header-container"></div>

    <h1 id="page-title"></h1>

    <div id="content"><ul id="results"></ul></div>

    <!-- Footer mount -->
    <div id="footer-container"></div>

    <script>
      // Register a service worker to cache core assets and provide network fallback
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js').catch(console.warn)
        })
      }
    </script>

    <script type="module">
      // Robust dynamic import with retries and cache-busting
      async function importWithRetry(url, attempts = 3) {
        let lastError
        for (let i = 0; i < attempts; i++) {
          const cacheBust = i === 0 ? '' : (url.includes('?') ? `&cb=${Date.now()}` : `?cb=${Date.now()}`)
          try {
            const mod = await import(url + cacheBust)
            return mod
          } catch (e) {
            lastError = e
            await new Promise(r => setTimeout(r, 300 * (i + 1)))
          }
        }
        throw lastError
      }
      const { buildCard, getTier1Icon } = await importWithRetry('./cards.js?v=20240115q').catch((err) => {
        console.error('Module import failed after retries:', err)
        throw err
      })

      // Add error handling for module loading
      window.addEventListener('error', function(e) {
        console.error('JavaScript error:', e.error);
        const content = document.getElementById('content');
        if (content) {
          content.innerHTML = `
            <div style="padding: 20px; color: #dc2626; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; margin: 20px;">
              <h3>Error Loading Page</h3>
              <p>There was an error loading the page. Please check:</p>
              <ul>
                <li>All files are uploaded to the server</li>
                <li>cards.js file exists</li>
                <li>040625-skills.xlsx file exists</li>
                <li>Server supports ES6 modules</li>
              </ul>
              <p><strong>Error:</strong> ${e.error ? e.error.message : 'Unknown error'}</p>
            </div>
          `;
        }
      });

      // Add fallback for module loading failures
      window.addEventListener('unhandledrejection', function(e) {
        console.error('Unhandled promise rejection:', e.reason);
        const content = document.getElementById('content');
        if (content) {
          content.innerHTML = `
            <div style="padding: 20px; color: #dc2626; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; margin: 20px;">
              <h3>Module Loading Error</h3>
              <p>Failed to load required modules. This might be due to:</p>
              <ul>
                <li>Missing cards.js file</li>
                <li>Server doesn't support ES6 modules</li>
                <li>Network connectivity issues</li>
              </ul>
              <p><strong>Error:</strong> ${e.reason}</p>
            </div>
          `;
        }
      });

      /* ---- Header/Footer loader from ./drs/inc/ ---- */
      Promise.all([
        fetch("./drs/inc/header.html").then((r) => (r.ok ? r.text() : "")),
        fetch("./drs/inc/footer.html").then((r) => (r.ok ? r.text() : "")),
      ])
        .then(([headerHtml, footerHtml]) => {
          const headerEl = document.getElementById("header-container")
          const footerEl = document.getElementById("footer-container")
          if (headerEl) headerEl.innerHTML = headerHtml
          if (footerEl) footerEl.innerHTML = footerHtml

          // Optional mobile menu wiring if header provides those elements:
          try {
            const overlay = document.querySelector(".mobile-menu-overlay")
            const body = document.body
            document
              .querySelector(".mobile-menu-toggle")
              ?.addEventListener("click", () => {
                overlay?.classList.add("active")
                body.classList.add("menu-open")
              })
            const close = () => {
              overlay?.classList.remove("active")
              body.classList.remove("menu-open")
            }
            document
              .querySelector(".mobile-menu-close")
              ?.addEventListener("click", close)
            document
              .querySelector(".mobile-menu-back-btn")
              ?.addEventListener("click", close)
            document
              .querySelectorAll(".mobile-nav a")
              ?.forEach((a) => a.addEventListener("click", close))
          } catch (e) {}
        })
        .catch(console.error)

      /* ---- Data loading (XLSX) ----
         Keep caching by default; bump ?sv=2 on the page URL after you update the sheet
         to force a fresh fetch. Optionally add &nocache once for a single no-store load. */
      const QS = new URLSearchParams(location.search)
      const SHEET_VERSION = QS.get("sv") || "2"
      const NO_CACHE = QS.has("nocache")
      const DATA_URL = `040625-skills.xlsx?v=${encodeURIComponent(
        SHEET_VERSION
      )}`

      function formatDate(date) {
        if (!date || date === "N/A") return ""
        try {
          return new Date(date).toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "2-digit",
          })
        } catch {
          return ""
        }
      }
      function formatForUrl(term) {
        return (term || "").replace(/\s+/g, "-")
      }
      function formatForDisplay(term) {
        return (term || "").replace(/-+/g, " ")
      }

      function loadXLSX(url) {
        const req = new Request(url, {
          cache: NO_CACHE ? "no-store" : "default",
        })
        return fetch(req)
          .then((r) => {
            if (!r.ok) throw new Error(`HTTP ${r.status}`)
            return r.arrayBuffer()
          })
          .then((buf) => {
            const wb = XLSX.read(buf, {
              type: "array",
              cellDates: true,
              dateNF: "yyyy-mm-dd",
            })
            const sheet = wb.Sheets[wb.SheetNames[0]]
            return XLSX.utils.sheet_to_json(sheet, {
              raw: false,
              defval: "N/A",
            })
          })
      }

      function getRoute() {
        const hash = window.location.hash.replace(/^#/, "")
        if (hash.startsWith("item/")) {
          const [, id, back = ""] = hash.split("/")
          return { mode: "detail", id, back }
        }
        return { mode: "list", term: formatForDisplay(hash) }
      }

                          function updatePageTitle(text, fallback) {
          const el = document.getElementById("page-title")
          const t = text && text.trim() ? text : fallback || ""
          console.log('updatePageTitle called with:', { text, fallback, t })
          if (text && text.trim()) {
            // There's a specific search term, show just the title
            document.title = `${t} - Steve Dooley, MBA`
            el.innerHTML = `<h3>${t}</h3>`
          } else {
            // No search term, show main title with logos
            document.title = "Steve Dooley, MBA"
            el.innerHTML = `
              <!-- <h3>Data Engineering/AI <span style="color: #9ca3af; font-weight: 300;">||</span> Cloud/Enterprise Platforms</h3> -->
              <!-- https://outthink.co/ -->
              <h1 class="typing-hero">
                Well-versed in<br/>
                <span id="typing-changing-word" class="typing-changing-word"></span><span class="typing-cursor">|</span>
              </h1>

              <p><div class="section-divider"></div></p>

              <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                <img src="img/logo/lockheed-martin-blue.png" alt="Lockheed Martin" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/logo-salesforce2.png" alt="Salesforce" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/logo-dod.png" alt="Department of Defense" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/booz-allen-hamilton.png" alt="Booz Allen Hamilton" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                
              </div>
              <p style="text-align: center; color: #6b7280; font-size: 12px; font-weight: 300; margin: 10px 0 5px 0;">Experience with the organizations above</p>
              <div style="text-align: center; margin: 10px 0;">
                <img src="img/logo/palantir.png" alt="Palantir" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                
                <img src="img/logo/ibm.png" alt="IBM" style="height: 40px; width: auto; max-width: 120px; object-fit: contain; margin: 0 10px;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/aws.png" alt="AWS" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/databricks-short.png" alt="Databricks" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
                <img src="img/logo/accenture.png" alt="Accenture" style="height: 40px; width: auto; max-width: 120px; object-fit: contain;" onerror="console.error('Failed to load:', this.src); this.style.display='none';" onload="console.log('Loaded:', this.src);">
              
              </div>
              <p style="text-align: center; color: #6b7280; font-size: 12px; font-weight: 300; margin: 10px 0 5px 0;">Training with the organizations above</p>
              
            `
            // Initialize typing animation after HTML is inserted
            // Load and execute typing script dynamically so element exists when script runs
            setTimeout(() => {
              const typingEl = document.getElementById("typing-changing-word");
              if (typingEl) {
                const script = document.createElement('script');
                script.src = 'drs/scripts/typing-120725.js';
                document.head.appendChild(script);
              }
            }, 0);
          }
        }

      function createTagLink(tag) {
        if (!tag || tag === "N/A") return ""
        const formatted = formatForUrl(tag.trim())
        return `<a href='#${formatted}' class='tag' onclick='event.preventDefault(); window.location.search=""; window.location.hash="${formatted}"; window.scrollTo(0,0);'>${tag}</a>`
      }

      /* ---- LIST (cards) ---- */
                           function renderList(searchTerm) {
          updatePageTitle(
            searchTerm
              ? `${formatForDisplay(
                  searchTerm
                ).toLowerCase()} skills & experience`
              : "",
            "Data Engineering/AI || Cloud/Enterprise Platforms"
          )

        loadXLSX(DATA_URL)
          .then((data) => {
            // Check for ?ids=47,46,34 in the URL
            const urlParams = new URLSearchParams(window.location.search)
            const idsParam = urlParams.get("ids")
            let filtered = data
            // First filter out hidden items and items with e_id 999
            filtered = filtered.filter((it) => (!it.hide || it.hide !== "yes") && it.e_id !== 999 && it.e_id !== "999")
            
            if (idsParam) {
              const idsArr = idsParam.split(",").map((id) => id.trim())
              filtered = filtered.filter((it) => idsArr.includes(String(it.e_id)))
            } else if (searchTerm) {
              filtered = filtered.filter((it) =>
                [it.tag1, it.tag2, it.tag3, it.tag4, it.tag5].some(
                  (t) =>
                    t &&
                    t !== "N/A" &&
                    t.toLowerCase().includes(searchTerm.toLowerCase())
                )
              )
            }
            // Separate cards with featured_top: "yes" to display at the top
            const topCards = filtered.filter(item => String(item['featured_top'] || '').toLowerCase() === 'yes')
            // Keep all cards for regular grouping (featured cards will appear twice)
            const regularCards = filtered
            
            // Sort featured cards by sort_order (same logic as regular cards)
            topCards.sort((a, b) => {
              // Sort by sort_order (numerically ascending), fallback to e_title
              const sa = Number(a.sort_order)
              const sb = Number(b.sort_order)
              if (!isNaN(sa) && !isNaN(sb)) {
                return sa - sb
              } else if (!isNaN(sa)) {
                return -1
              } else if (!isNaN(sb)) {
                return 1
              } else {
                return a.e_title.localeCompare(b.e_title)
              }
            })
            // Sort regular cards by e_id (they'll be re-sorted by sort_order in their e_type groups)
            regularCards.sort((a, b) => Number(a.e_id) - Number(b.e_id))

            const content = document.getElementById("content")
            content.innerHTML = '<ul id="results"></ul>'
            const results = document.getElementById("results")

            if (!filtered.length) {
              results.textContent = "No results found."
              return
            }

            // First, display top cards if any exist
            if (topCards.length > 0) {
              // Add header for featured top cards
              const h2 = document.createElement("h2")
              h2.innerHTML = `<i class="fa fa-bullseye" aria-hidden="true" title="Featured" style="color:#4169E1;"></i> Featured`
              results.appendChild(h2)
              
              const topUl = document.createElement("ul")
              topCards.forEach((item) => {
                const li = document.createElement("li")
                const currentHash = window.location.hash.replace(/^#/, "")
                li.innerHTML = buildCard(item, currentHash)
                topUl.appendChild(li)
              })
              results.appendChild(topUl)
            }

            // Group regular cards by e_type (use first 2 characters for consistent grouping)
            const grouped = {}
            for (const it of regularCards) {
              const t = String(it.e_type || "Uncategorized").substring(0, 2)
              ;(grouped[t] ||= []).push(it)
            }

            for (const type of Object.keys(grouped).sort()) {
              const info = getEventTypeInfo(type)
              const h2 = document.createElement("h2")
              h2.innerHTML = `${info.icon} ${info.title}`
              if (info.anchor) h2.id = info.anchor
              results.appendChild(h2)

              const ul = document.createElement("ul")
              grouped[type]
                .sort((a, b) => {
                  // Sort by sort_order (numerically ascending), fallback to e_title
                  const sa = Number(a.sort_order)
                  const sb = Number(b.sort_order)
                  if (!isNaN(sa) && !isNaN(sb)) {
                    return sa - sb
                  } else if (!isNaN(sa)) {
                    return -1
                  } else if (!isNaN(sb)) {
                    return 1
                  } else {
                    return a.e_title.localeCompare(b.e_title)
                  }
                })
                .forEach((item) => {
                  const li = document.createElement("li")
                  const currentHash = window.location.hash.replace(/^#/, "")
                  li.innerHTML = buildCard(item, currentHash) // card markup from cards.js
                  ul.appendChild(li)
                })
              results.appendChild(ul)
            }
          })
          .catch((err) => {
            console.error("Error loading XLSX:", err)
            const results = document.getElementById("results")
            if (results) results.textContent = "Error loading data."
          })
      }

      /* ---- DETAIL (image 80px if present; otherwise large fallback title) ---- */
      function renderDetail(itemId, backHash) {
        loadXLSX(DATA_URL)
          .then((data) => {
            // Filter out hidden items and items with e_id 999
            const filtered = data.filter((it) => (!it.hide || it.hide !== "yes") && it.e_id !== 999 && it.e_id !== "999")
            const itemIndex = filtered.findIndex(
              (x) => String(x.e_id).trim() === String(itemId).trim()
            )
            const item = filtered[itemIndex]
            const content = document.getElementById("content")
            if (!item || (item.hide && item.hide === "yes")) {
              updatePageTitle("Not found")
              content.innerHTML = `<div class="detail-wrapper"><p>Item not found.</p><p class="back-row"><a href="#${decodeURIComponent(
                backHash || ""
              )}">‚Üê Back</a></p></div>`
              return
            }

            const tagLinks = [
              item.tag1,
              item.tag2,
              item.tag3,
              item.tag4,
              item.tag5,
            ]
              .filter((t) => t && t !== "N/A")
              .map(createTagLink)
              .join(" ")
                         const sponsor =
               item.e_sponsoring && item.e_sponsoring !== "N/A"
                 ? item.e_sponsoring
                 : ""
            const sponsorDisplay = sponsor === "Booz Allen" 
              ? `<img src="img/logo/booz-allen-hamilton.png" alt="Booz Allen Hamilton" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Palantir"
              ? `<img src="img/logo/palantir.png" alt="Palantir" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Salesforce"
              ? `<img src="img/logo/salesforcev2.png" alt="Salesforce" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Lockheed Martin Information Services"
              ? `<img src="img/logo/lockheed-martin-blue.png" alt="Lockheed Martin Information Services" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Amazon Web Services (AWS)"
              ? `<img src="img/logo/aws.png" alt="Amazon Web Services (AWS)" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Databricks"
              ? `<img src="img/logo/databricks-long.png" alt="Databricks" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "IBM"
              ? `<img src="img/logo/ibm.png" alt="IBM" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor === "Accenture"
              ? `<img src="img/logo/accenture.png" alt="Accenture" style="height: 30px; width: auto; vertical-align: middle;">`
              : sponsor
            updatePageTitle(item.e_title)
            const backTarget = decodeURIComponent(backHash || "")
            const backHref = `#${backTarget}`

                         const safeTitle = String(item.e_title || "")
               .replace(/&/g, "&amp;")
               .replace(/</g, "&lt;")
               .replace(/>/g, "&gt;")
             const hasImage = item.e_image && item.e_image !== "N/A"
             const mediaClass = hasImage ? "detail-media has-image" : "detail-media"
                           const detailIcon = getTier1Icon(item.icon_item);
             const detailMedia = hasImage 
                ? `<img src="img/cards/${item.e_image}" alt="${safeTitle}" style="width: 100%; height: 100%; object-fit: contain; object-position: center; display: block;">`
                : `<div class="media-title-fallback"><div style="display: flex; flex-direction: column; align-items: center; gap: 8px; justify-content: center;"><span class="tier1-icon">${detailIcon}</span><span class="tier1-title">${safeTitle}</span></div></div>`

            // Use displayDateShort logic for old dates
            function displayDateShort(value) {
              if (!value || value === "N/A") return ""
              const d = new Date(value)
              if (Number.isNaN(+d)) return ""
              const y = d.getFullYear()
              if (y < 2021) return "4+ years ago"
              const m = [
                "Jan",
                "Feb",
                "Mar",
                "Apr",
                "May",
                "Jun",
                "Jul",
                "Aug",
                "Sep",
                "Oct",
                "Nov",
                "Dec",
              ][d.getMonth()]
              return `${m} ${y}`
            }
            const fullDate = displayDateShort(item.e_date)
            // Lightbox overlay style
            // Make overlay scrollable and card wider
            const overlayStyle = `position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(30,41,59,0.85);z-index:2000;display:flex;align-items:center;justify-content:center;overflow:auto;`
                         const cardStyle = `max-width:1200px;width:95vw;height:85vh;box-shadow:0 8px 32px rgba(0,0,0,0.18);border-radius:18px;overflow:hidden;position:relative;background:#fff;display:flex;flex-direction:column;`

            // Arrow navigation with looping (using filtered data)
            const prevIndex = itemIndex > 0 ? itemIndex - 1 : filtered.length - 1
            const nextIndex = itemIndex < filtered.length - 1 ? itemIndex + 1 : 0
            const prevId = filtered[prevIndex].e_id
            const nextId = filtered[nextIndex].e_id

                         content.innerHTML = `
               <div id="lightbox-overlay" style="${overlayStyle}">
                 <div class="detail-card" style="${cardStyle}">
                   <button id="close-lightbox" style="position:absolute;top:8px;right:8px;z-index:10;background:#ffffff;border:1px solid #6b7280;border-radius:50%;width:40px;height:40px;font-size:1.2em;color:#374151;cursor:pointer;line-height:1;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;opacity:0.7;" title="Close" onmouseover="this.style.background='#dc2626';this.style.border='#dc2626';this.style.color='#ffffff';this.style.opacity='1'" onmouseout="this.style.background='#ffffff';this.style.border='#6b7280';this.style.color='#374151';this.style.opacity='0.7'">&times;</button>
                   
                   
                                       ${hasImage ? `
                      <div style="display: flex; height: 100%;">
                        <div style="width: 50%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px;">
                          <div style="width: 75%; height: 75%; display: flex; align-items: center; justify-content: center;">
                            ${detailMedia}
                          </div>
                        </div>
                        <div style="width: 50%; height: 100%; display: flex; flex-direction: column;">
                         <div class="detail-header">
                           <div class="detail-meta">
                             <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                               <div>
                                 <div style="margin-bottom: 8px; color: #0f172a;">${getEventTypeInfo(item.e_type).icon} ${getEventTypeInfo(item.e_type).title}</div>
                                 ${sponsor ? `<div>${sponsorDisplay}</div>` : ""}
                                 <div style="margin-top:4px;">
                                   ${fullDate ? `<span>${fullDate}</span>` : ""}
                                   ${item.e_url !== "N/A" ? `<a class="verify-link" href="${item.e_url}" target="_blank" style="margin-left:8px;">verify <i class="fa fa-external-link" aria-hidden="true" style="font-size: 0.9em; opacity: 0.7;"></i></a>` : ""}
                                 </div>
                                 <!-- <h3 id="card-title-top">${item.e_title || ""}</h3> -->
                               </div>
                               <div style="display:flex;align-items:center;gap:8px;">
                                 <div style="display:flex;flex-direction:column;align-items:center;">
                                   <button id="arrow-left" style="background:#ffffff;border:1px solid #6b7280;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;" onmouseover="this.style.background='#10b981';this.style.border='#10b981';this.querySelector('i').style.color='#ffffff'" onmouseout="this.style.background='#ffffff';this.style.border='#6b7280';this.querySelector('i').style.color='#374151'">
                                     <i class="fa fa-chevron-left" style="font-size:1.2em;color:#374151;transition:color 0.2s ease;"></i>
                                   </button>
                                   <span style="font-size:0.8em;color:#666;margin-top:2px;">Previous</span>
                                 </div>
                                 <div style="display:flex;flex-direction:column;align-items:center;">
                                   <button id="arrow-right" style="background:#ffffff;border:1px solid #6b7280;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;" onmouseover="this.style.background='#10b981';this.style.border='#10b981';this.querySelector('i').style.color='#ffffff'" onmouseout="this.style.background='#ffffff';this.style.border='#6b7280';this.querySelector('i').style.color='#374151'">
                                     <i class="fa fa-chevron-right" style="font-size:1.2em;color:#374151;transition:color 0.2s ease;"></i>
                                   </button>
                                   <span style="font-size:0.8em;color:#666;margin-top:2px;">Next</span>
                                 </div>
                               </div>
                             </div>
                           </div>
                         </div>
                         <div class="section-divider"></div>
                         <div class="detail-body" style="padding: 0 24px; flex: 1; overflow-y: auto;" id="detail-content">
                           ${item.e_desc && item.e_desc !== "N/A" ? item.e_desc : ""}
                           ${(item.e_id !== undefined && item.e_id !== null) ? `<div style="margin-top: 12px; color: white; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 0.9rem;">${item.e_id}</div>` : ""}
                         </div>
                         ${tagLinks ? `<div class="detail-tags" style="padding: 0 24px;">${tagLinks}</div>` : ""}
                       </div>
                     </div>
                   ` : `
                     <div class="${mediaClass}">${detailMedia}</div>
                     <div class="detail-header">
                       <div class="detail-meta">
                         <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                           <div>
                             <div style="margin-bottom: 8px; color: #0f172a;">${getEventTypeInfo(item.e_type).icon} ${getEventTypeInfo(item.e_type).title}</div>
                             ${sponsor ? `<div>${sponsorDisplay}</div>` : ""}
                             <div style="margin-top:4px;">
                               ${fullDate ? `<span>${fullDate}</span>` : ""}
                               ${item.e_url !== "N/A" ? `<a class="verify-link" href="${item.e_url}" target="_blank" style="margin-left:8px;">verify <i class="fa fa-external-link" aria-hidden="true" style="font-size: 0.9em; opacity: 0.7;"></i></a>` : ""}
                             </div>
                             <!-- <h3 id="card-title-top">${item.e_title || ""}</h3> -->
                           </div>
                           <div style="display:flex;align-items:center;gap:8px;">
                             <div style="display:flex;flex-direction:column;align-items:center;">
                               <button id="arrow-left" style="background:rgba(255,255,255,0.9);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;opacity:0.8;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(0,0,0,0.15);" onmouseover="this.style.background='#10b981';this.style.opacity='1';this.querySelector('i').style.color='#ffffff'" onmouseout="this.style.background='rgba(255,255,255,0.9)';this.style.opacity='0.8';this.querySelector('i').style.color='#374151'">
                                 <i class="fa fa-chevron-left" style="font-size:1.2em;color:#374151;transition:color 0.2s ease;"></i>
                               </button>
                               <span style="font-size:0.8em;color:#666;margin-top:2px;">Previous</span>
                             </div>
                             <div style="display:flex;flex-direction:column;align-items:center;">
                               <button id="arrow-right" style="background:rgba(255,255,255,0.9);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;opacity:0.8;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(0,0,0,0.15);" onmouseover="this.style.background='#10b981';this.style.opacity='1';this.querySelector('i').style.color='#ffffff'" onmouseout="this.style.background='rgba(255,255,255,0.9)';this.style.opacity='0.8';this.querySelector('i').style.color='#374151'">
                                 <i class="fa fa-chevron-right" style="font-size:1.2em;color:#374151;transition:color 0.2s ease;"></i>
                               </button>
                               <span style="font-size:0.8em;color:#666;margin-top:2px;">Next</span>
                             </div>
                           </div>
                         </div>
                       </div>
                     </div>
                     <div class="section-divider"></div>
                     <div class="detail-body" style="padding: 0 24px; flex: 1; overflow-y: auto;" id="detail-content">
                       ${item.e_desc && item.e_desc !== "N/A" ? item.e_desc : ""}
                       ${(item.e_id !== undefined && item.e_id !== null) ? `<div style="margin-top: 12px; color: white; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 0.9rem;">${item.e_id}</div>` : ""}
                     </div>
                     ${tagLinks ? `<div class="detail-tags" style="padding: 0 24px;">${tagLinks}</div>` : ""}
                   `}
                 </div>
               </div>
             `

                         // Check if e_desc contains file inclusions and load external HTML content
             if (item.e_desc === "[inc]" || item.e_desc.includes("[") && item.e_desc.includes(".html]")) {
               const detailContent = document.getElementById("detail-content")
               if (detailContent) {
                 let processedContent = ""
                 
                 if (item.e_desc === "[inc]") {
                   // Handle single file inclusion
                   const incFile = `drs/inc/html/${item.e_id}.html`
                   fetch(incFile)
                     .then(response => {
                       if (response.ok) {
                         return response.text()
                       } else {
                         throw new Error(`HTTP ${response.status}`)
                       }
                     })
                     .then(htmlContent => {
                       processedContent = htmlContent
                       processContentWithIncludes(processedContent, detailContent, item)
                     })
                     .catch(error => {
                       console.error(`Error loading include file ${incFile}:`, error)
                       detailContent.innerHTML = `<p style="color: #ef4444;">Error loading content from ${incFile}</p>`
                     })
                 } else {
                   // Handle multiple file inclusions like [31.html] [32.html]
                   processedContent = item.e_desc
                   processContentWithIncludes(processedContent, detailContent, item)
                 }
               }
             }
             
             // Helper function to process content with includes
             function processContentWithIncludes(content, detailContent, item) {
               console.log('Processing content for item', item.e_id, ':', content);
               
               // Replace [e_title] placeholder with actual title
               let processedContent = content.replace(/\[e_title\]/g, item.e_title || "");
               
               // Replace [image-filename.png] placeholder with specific image
               processedContent = processedContent.replace(
                 /\[image-([^\]]+)\]/g, 
                 (match, filename) => `<p><img
style="max-width: 80%; cursor: pointer; transition: transform 0.2s ease;"
alt="${item.e_title || 'Image'}"
src="img/cards/${filename}"
onclick="window.expandImage(this)"
onmouseover="this.style.transform='scale(1.02)'"
onmouseout="this.style.transform='scale(1)'"
/></p>`
               )
               
               // Replace [image] placeholder with actual image code (uses e_id)
               processedContent = processedContent.replace(
                 /\[image\]/g, 
                 `<p><img
style="max-width: 80%; cursor: pointer; transition: transform 0.2s ease;"
alt="${item.e_title || 'Image'}"
src="img/cards/${item.e_id}.png"
onclick="window.expandImage(this)"
onmouseover="this.style.transform='scale(1.02)'"
onmouseout="this.style.transform='scale(1)'"
/></p>`
               )
               
               console.log('After image processing for item', item.e_id, ':', processedContent);
               
               // Replace multiple file inclusions like [31.html] [32.html]
               processedContent = processedContent.replace(
                 /\[(\d+\.html)\]/g,
                 (match, filename) => {
                   // This will be replaced with actual content in the next step
                   return `<!--INCLUDE:${filename}-->`
                 }
               )
               
               detailContent.innerHTML = processedContent
               
               // Now load and replace the included files
               const includePromises = []
               const includeMatches = processedContent.match(/<!--INCLUDE:(\d+\.html)-->/g)
               
               if (includeMatches) {
                 includeMatches.forEach(match => {
                   const filename = match.replace(/<!--INCLUDE:|-->/g, '')
                   const includePromise = fetch(`drs/inc/html/${filename}`)
                     .then(response => response.ok ? response.text() : `[Content not found: ${filename}]`)
                     .then(content => {
                       // Process image placeholders in the included content
                       let processedContent = content
                       
                       // Replace [image-filename.png] placeholder with specific image
                       processedContent = processedContent.replace(
                         /\[image-([^\]]+)\]/g, 
                         (match, filename) => `<p><img
style="max-width: 80%; cursor: pointer; transition: transform 0.2s ease;"
alt="${item.e_title || 'Image'}"
src="img/cards/${filename}"
onclick="window.expandImage(this)"
onmouseover="this.style.transform='scale(1.02)'"
onmouseout="this.style.transform='scale(1)'"
/></p>`
                       )
                       
                       // Replace [image] placeholder with actual image code (uses e_id)
                       processedContent = processedContent.replace(
                         /\[image\]/g, 
                         `<p><img
style="max-width: 80%; cursor: pointer; transition: transform 0.2s ease;"
alt="${item.e_title || 'Image'}"
src="img/cards/${item.e_id}.png"
onclick="window.expandImage(this)"
onmouseover="this.style.transform='scale(1.02)'"
onmouseout="this.style.transform='scale(1)'"
/></p>`
                       )
                       
                       // Replace the placeholder with processed content
                       detailContent.innerHTML = detailContent.innerHTML.replace(match, processedContent)
                     })
                     .catch(error => {
                       console.error(`Error loading include file ${filename}:`, error)
                       detailContent.innerHTML = detailContent.innerHTML.replace(match, `[Error loading: ${filename}]`)
                     })
                   includePromises.push(includePromise)
                 })
                 
                 // Wait for all includes to load
                 Promise.all(includePromises).then(() => {
                   console.log(`Loaded ${includePromises.length} include files for item ${item.e_id}`)
                 })
               }
             }

             // Add arrow navigation and close event listeners
             setTimeout(() => {
               const leftBtn = document.getElementById("arrow-left")
               const rightBtn = document.getElementById("arrow-right")
               const closeBtn = document.getElementById("close-lightbox")
               if (leftBtn) {
                 leftBtn.addEventListener("click", () => {
                   window.location.hash = `item/${prevId}/${backHash || ""}`
                 })
               }
               if (rightBtn) {
                 rightBtn.addEventListener("click", () => {
                   window.location.hash = `item/${nextId}/${backHash || ""}`
                 })
               }
               if (closeBtn) {
                 closeBtn.addEventListener("click", () => {
                   window.location.hash = backHash ? `#${backHash}` : "#"
                 })
               }
             }, 0)
          })
          .catch((err) => {
            console.error("Error loading XLSX:", err)
            const results = document.getElementById("results")
            if (results) results.textContent = "Error loading data."
          })
      }

      function getEventTypeInfo(type) {
        // keeps headings/icons for each e_type
        const eventType = String(type || "").substring(0, 2)
        switch (eventType) {
          case "01":
            return {
              icon: '<i class="fa fa-bullseye" aria-hidden="true" title="Featured" style="color:#4169E1;"></i>',
              title: "Featured",
              anchor: "featured",
            }
          case "02":
            return {
              icon: '<i class="fa fa-id-badge" aria-hidden="true" title="Work Experience"></i>',
              title: "Work Experience",
              anchor: "experience",
            }
          case "03":
            return {
              icon: '<i class="fa fa-university" aria-hidden="true" title="Courses & Certificates"></i>',
              title: "Courses & Certificates",
              anchor: "courses",
            }
          case "04":
            return {
              icon: '<i class="fa fa-certificate" aria-hidden="true" title="x"></i>',
              title: "x",
            }
          case "05":
            return {
              icon: '<i class="fa fa-comments-o" aria-hidden="true" title="Feedback"></i>',
              title: "Feedback",
            }
          case "06":
            return {
              icon: '<i class="fa fa-chalkboard-teacher" aria-hidden="true" title="Presentations & Workshops"></i>',
              title: "Presentations & Workshops",
              anchor: "presentations",
            }
          case "07":
            return {
              icon: '<i class="fa fa-chalkboard-teacher" aria-hidden="true" title="Case Studies"></i>',
              title: "Case Studies",
              anchor: "case-studies",
            }
          case "08":
            return {
              icon: '<i class="fa fa-trophy" aria-hidden="true" title="Awards"></i>',
              title: "Awards",
            }
          case "09":
            return {
              icon: '<i class="fa-regular fa-rectangle-list" aria-hidden="true" title="Summary"></i>',
              title: "Summary",
              anchor: "summary"
            }
          default:
            return { icon: "", title: type || "Uncategorized" }
        }
      }

      // Global function for expanding images
      window.expandImage = function(img) {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0, 0, 0, 0.9);
          z-index: 9999;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
        `;
        
        // Create expanded image
        const expandedImg = document.createElement('img');
        expandedImg.src = img.src;
        expandedImg.alt = img.alt;
        expandedImg.style.cssText = `
          max-width: 90vw;
          max-height: 90vh;
          object-fit: contain;
          border-radius: 8px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        `;
        
        // Add close functionality
        overlay.onclick = function() {
          document.body.removeChild(overlay);
        };
        
        // Prevent image click from closing
        expandedImg.onclick = function(e) {
          e.stopPropagation();
        };
        
        overlay.appendChild(expandedImg);
        document.body.appendChild(overlay);
      };

      function handleRoute() {
        const r = getRoute()
        if (r.mode === "detail") renderDetail(r.id, r.back)
        else renderList(r.term)
      }
      handleRoute()
      window.addEventListener("hashchange", handleRoute)
    </script>

    <!-- 100% privacy-first analytics simpleanalytics.com 100525 -->
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>


  </body>
</html>
